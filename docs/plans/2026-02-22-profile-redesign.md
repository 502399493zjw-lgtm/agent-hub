# ä¸ªäººä¸»é¡µé‡è®¾è®¡ â€” Design Doc

> æ—¥æœŸï¼š2026-02-22
> çŠ¶æ€ï¼šâœ… Approved by æŒ‡æŒ¥å®˜

## èƒŒæ™¯

å½“å‰ `/dashboard` å’Œ `/user/[id]` æ˜¯ä¸¤ä¸ªç‹¬ç«‹é¡µé¢ï¼ŒDashboard ä»…è‡ªå·±å¯è§ï¼Œä¸ªäººä¸»é¡µåŸºäºå·²åºŸå¼ƒçš„ `user_profiles` mock è¡¨ã€‚éœ€è¦åˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„ä¸ªäººä¸»é¡µï¼ŒåŒæ—¶æ”¯æŒé‚®ç®±ç”¨æˆ·ç¼–è¾‘å¤´åƒ/åå­—ã€å±•ç¤ºç¤¾åŒºæ´»åŠ¨æ—¶é—´çº¿ã€‚

## æ–¹æ¡ˆå†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| Dashboard + ä¸ªäººä¸»é¡µ | **åˆå¹¶åˆ° `/user/[id]`**ï¼Œç æ‰ `/dashboard` | ä¸€ä¸ª"ä¸»é¡µ"æ¦‚å¿µï¼ŒisOwn æ§åˆ¶æ˜¾éš |
| å¤´åƒç¼–è¾‘ | **æ–‡ä»¶ä¸Šä¼ åˆ° `/data/avatars/`** | ç¤¾åŒºäº§å“åŸºç¡€ä½“éªŒï¼Œsharp å‹ç¼© |
| ç¼–è¾‘æƒé™ | **ä»… `provider === 'email'` ç”¨æˆ·** | OAuth ç”¨æˆ·é”æ­»ç”¨ provider ä¿¡æ¯ |
| å¤´åƒå…œåº• | **Letter Avatar**ï¼ˆé¦–å­— + hash é¢œè‰²ï¼‰ | é‚®ç®±ç”¨æˆ·ä¸ä¸Šä¼ ä¹Ÿå¥½çœ‹ |
| ç¤¾åŒºåŠ¨æ€ | **æ—¶é—´çº¿æµ**ï¼Œä» `coin_events` èšåˆ | ç¤¾åŒºæ„Ÿå¼ºï¼Œæ•°æ®å·²æœ‰ |
| é‚®ç®± Onboarding | **æ³¨å†Œåå¼ºåˆ¶è·³ `/onboarding`** | ä½“éªŒå®Œæ•´ï¼Œé¡µé¢å·²å­˜åœ¨ |

## é¡µé¢ç»“æ„

```
/user/[id]
â”œâ”€â”€ å¤´éƒ¨å¡ç‰‡ï¼ˆå…¬å¼€ï¼‰
â”‚   â”œâ”€â”€ å¤´åƒï¼ˆä¸‰çº§ fallback: custom â†’ provider â†’ letter avatarï¼‰
â”‚   â”œâ”€â”€ æ˜µç§° + è§’è‰²å¾½ç« ï¼ˆadminğŸ›¡ï¸ / agentğŸ¤–ï¼‰
â”‚   â”œâ”€â”€ Bio
â”‚   â”œâ”€â”€ Meta: æ¥æºå›¾æ ‡ / åŠ å…¥æ—¶é—´ / å£°æœ›
â”‚   â””â”€â”€ æ“ä½œæŒ‰é’®ï¼šè‡ªå·±â†’ç¼–è¾‘èµ„æ–™ï¼Œä»–äººâ†’å…³æ³¨(disabled)
â”œâ”€â”€ ç»Ÿè®¡æ ï¼ˆå…¬å¼€ï¼Œ5 æ ¼æ¨ªæ’ï¼‰
â”‚   â””â”€â”€ ğŸ“¦èµ„äº§ / â¬‡ï¸ä¸‹è½½ / â­Star / ğŸ’¬è¯„è®º / ğŸ›Issue
â”œâ”€â”€ Tabs
â”‚   â”œâ”€â”€ ğŸ“¦ èµ„äº§ï¼ˆå…¬å¼€ï¼‰â€” AssetCard ç½‘æ ¼
â”‚   â”œâ”€â”€ ğŸ“° ç¤¾åŒºåŠ¨æ€ï¼ˆå…¬å¼€ï¼‰â€” coin_events æ—¶é—´çº¿
â”‚   â”œâ”€â”€ ğŸ“Š æ•°æ®ï¼ˆä»… isOwnï¼‰â€” ä¸‹è½½è¶‹åŠ¿ + æ”¶åˆ°çš„è¯„è®º/Issue
â”‚   â””â”€â”€ ğŸ“ å…³äºï¼ˆå…¬å¼€ï¼‰â€” OAuthæ¥æº + ç»æµç³»ç»Ÿ
â””â”€â”€ ç¼–è¾‘ Profile Modalï¼ˆä»… isOwn + ä»…é‚®ç®±ç”¨æˆ·ï¼‰
    â”œâ”€â”€ ä¿®æ”¹æ˜µç§°ï¼ˆå¿…å¡«ï¼‰
    â”œâ”€â”€ ä¸Šä¼ å¤´åƒï¼ˆé€‰å¡«ï¼‰
    â””â”€â”€ ä¿®æ”¹ Bioï¼ˆé€‰å¡«ï¼‰
```

## Letter Avatar

- é¢œè‰²æ±  8 è‰²ï¼š`['#3B82F6','#10B981','#F59E0B','#8B5CF6','#EF4444','#06B6D4','#EC4899','#6366F1']`
- é€‰è‰²ï¼š`userId.charCodeAt(0) % 8`
- æ–‡å­—ï¼š`name[0].toUpperCase()`ï¼Œç™½è‰² boldï¼Œåœ†è§’æ–¹å½¢

## ç¤¾åŒºåŠ¨æ€æ—¶é—´çº¿

ä» `coin_events` è¡¨æŒ‰ `created_at DESC` åˆ†é¡µæŸ¥è¯¢ï¼š

```
ğŸš€ å‘å¸ƒäº† pdf-watcher                    2 å°æ—¶å‰
ğŸ’¬ è¯„è®ºäº† chrome-automation               5 å°æ—¶å‰
ğŸ› æäº¤äº† Issue: "å®‰è£…å¤±è´¥"                æ˜¨å¤©
â­ è·å¾— +10 å£°æœ›ï¼ˆå‘å¸ƒèµ„äº§å¥–åŠ±ï¼‰            æ˜¨å¤©
```

äº‹ä»¶ç±»å‹æ˜ å°„ï¼š
| event | å›¾æ ‡ | æè¿°æ¨¡æ¿ |
|-------|------|----------|
| publish_asset | ğŸš€ | å‘å¸ƒäº† {asset_name} |
| write_comment | ğŸ’¬ | è¯„è®ºäº† {asset_name} |
| submit_issue | ğŸ› | æäº¤äº† Issue |
| register_bonus | ğŸ‰ | åŠ å…¥äº†æ°´äº§å¸‚åœº |
| install_asset | â¬‡ï¸ | å®‰è£…äº† {asset_name} |
| å…¶ä»– reputation | â­ | è·å¾— +{amount} å£°æœ› |
| å…¶ä»– shrimp_coin | ğŸ¦ | è·å¾— +{amount} å…»è™¾å¸ |

## æ–°å¢ API

| è·¯ç”± | æ–¹æ³• | Auth | è¯´æ˜ |
|------|------|------|------|
| `/api/users/[id]/avatar` | POST | session, ä»…è‡ªå·±+é‚®ç®± | multipart ä¸Šä¼ , sharp â†’ webp 200x200, å­˜ data/avatars/ |
| `/api/users/[id]/profile` | PATCH | session, ä»…è‡ªå·± | ä¿®æ”¹ name(ä»…é‚®ç®±)/bio, é•¿åº¦æ ¡éªŒ |
| `/api/users/[id]/activity` | GET | public | coin_events åˆ†é¡µ, ?page=1&pageSize=20 |

## æ–‡ä»¶å˜åŠ¨æ¸…å•

| æ“ä½œ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| é‡å†™ | `src/app/user/[id]/page.tsx` | Server Component, æŸ¥ users+assets |
| é‡å†™ | `src/app/user/[id]/client.tsx` | å®Œæ•´ä¸ªäººä¸»é¡µ UIï¼Œå«æ‰€æœ‰ Tabs |
| åˆ é™¤ | `src/app/dashboard/page.tsx` | åŠŸèƒ½åˆå¹¶åˆ° user page |
| æ–°å¢ | `src/app/api/users/[id]/avatar/route.ts` | å¤´åƒä¸Šä¼  |
| æ–°å¢ | `src/app/api/users/[id]/profile/route.ts` | ç¼–è¾‘èµ„æ–™ |
| æ–°å¢ | `src/app/api/users/[id]/activity/route.ts` | ç¤¾åŒºåŠ¨æ€ |
| æ–°å¢ | `src/components/letter-avatar.tsx` | Letter Avatar ç»„ä»¶ |
| ä¿®æ”¹ | `src/components/navbar.tsx` | Dashboardâ†’ä¸ªäººä¸»é¡µ |
| ä¿®æ”¹ | `src/components/asset-card.tsx` | ä½œè€…å¤´åƒç”¨ LetterAvatar fallback |
| ä¿®æ”¹ | `src/app/onboarding/page.tsx` | åŠ å¤´åƒä¸Šä¼ ç»„ä»¶ |
| ä¿®æ”¹ | `src/lib/db/users.ts` | åŠ  updateProfile / updateAvatar |
| ä¿®æ”¹ | `src/lib/db/economy.ts` | åŠ  getUserCoinEvents åˆ†é¡µæŸ¥è¯¢ |
| æ–°å¢ | `next.config.ts` æˆ– route | /data/avatars é™æ€æœåŠ¡ |
| æ–°å¢ | `package.json` | åŠ  sharp ä¾èµ– |

## æ³¨æ„äº‹é¡¹

- ç»Ÿè®¡èšåˆç›®å‰ O(N)ï¼Œè¶… 1000 èµ„äº§åéœ€ç‰©åŒ–è§†å›¾/ç¼“å­˜
- å…³æ³¨æŒ‰é’®å…ˆ disabled å ä½
- sharp åœ¨ Docker alpine é‡Œéœ€è¦ç¡®è®¤å…¼å®¹æ€§ï¼ˆä¸€èˆ¬ OKï¼‰
- Letter Avatar æ˜¯çº¯å‰ç«¯ç»„ä»¶ï¼Œä¸ç”Ÿæˆå›¾ç‰‡æ–‡ä»¶
